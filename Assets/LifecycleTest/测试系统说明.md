# Unity 生命周期和 Animator 测试系统

## 已完成的功能

### 1. 测试结果序列化系统
- ✅ `LifecycleTestResult.cs` - 生命周期测试结果数据类
- ✅ `AnimatorTestResult.cs` - Animator 测试结果数据类
- ✅ `TestResultManager.cs` - 测试结果管理器（单例模式）
- ✅ 支持 JSON 格式保存
- ✅ 支持文本总结报告生成

### 2. 测试脚本增强
- ✅ `UnityLifecycleTester.cs` - 已添加结果记录功能
- ✅ `AnimatorStateListener.cs` - 已添加结果记录功能
- ✅ `AnimationEventReceiver.cs` - 已添加结果记录功能

### 3. 测试运行器
- ✅ `TestRunner.cs` - 自动运行测试并保存结果
- ✅ 支持自动运行和手动运行
- ✅ 测试完成后自动保存结果

## 使用方法

### 方法1：自动运行测试
1. 确保场景中有 `TestRunner` GameObject 并添加了 `TestRunner` 组件
2. 运行场景（点击 Play）
3. 测试会自动运行 5 秒（可在 Inspector 中修改 `testDuration`）
4. 测试完成后，结果会自动保存到 `TestResults` 文件夹

### 方法2：手动运行测试
1. 在场景中选择 `TestRunner` GameObject
2. 在 Inspector 中点击右键，选择 "手动运行测试"
3. 或通过代码调用 `TestRunner.ManualRunTests()`

## 输出文件

测试结果会保存到项目根目录的 `TestResults` 文件夹中：

### 生命周期测试结果
- `LifecycleTest_YYYYMMDD_HHMMSS.json` - JSON 格式的完整数据
- `LifecycleTest_YYYYMMDD_HHMMSS_Summary.txt` - 文本格式的总结报告

### Animator 测试结果（待修复）
- `AnimatorTest_YYYYMMDD_HHMMSS.json` - JSON 格式的完整数据
- `AnimatorTest_YYYYMMDD_HHMMSS_Summary.txt` - 文本格式的总结报告

## 已知问题

1. **Animator 测试结果记录暂时禁用**
   - 由于 Unity 编译缓存问题，AnimatorTestResult 相关代码暂时注释
   - 生命周期测试功能完全正常
   - 需要手动刷新 Unity 编辑器或重启 Unity 来解决编译缓存问题

## 测试结果格式

### JSON 格式
```json
{
  "testName": "Unity生命周期完整测试",
  "startTime": "2024-01-01 12:00:00.000",
  "events": [
    {
      "eventName": "Awake",
      "time": 0.000000,
      "frame": 0,
      "deltaTime": 0.000000,
      "normalizedTime": 0,
      "additionalInfo": "InstanceID: 1"
    }
  ]
}
```

### 总结报告格式
```
=== 生命周期测试结果总结 ===
测试名称: Unity生命周期完整测试
开始时间: 2024-01-01 12:00:00.000
总事件数: 50

=== 事件类型统计 ===
Awake: 2 次
OnEnable: 2 次
Start: 2 次
Update: 6 次
...

=== 执行顺序（前20个事件）===
1. [0] Awake - 时间: 0.000000, deltaTime: 0.000000
2. [0] OnEnable - 时间: 0.000000, deltaTime: 0.000000
...
```

## 下一步

1. 解决 Unity 编译缓存问题，启用 Animator 测试结果记录
2. 添加更多测试场景和用例
3. 添加结果分析和可视化功能
4. 添加自动化测试报告生成


